<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log in</title>
    <link rel="stylesheet" type="text/css" href="../css/m.css">
    <link rel="stylesheet" type="text/css" href="../css/log-in.css">
    <link rel="stylesheet" type="text/css" href="../css/alert_button.css">
</head>
<body onload="main()">
    <div class="ed" id="edit">
        <img class="bg" style="opacity: 0.25" alt="" src="../pic/yz.jpg">
    </div>  
    <div id="topm">
        <ul class="topmenu">
            <li><img src="../pic/stream-pig.gif" width="40" height="40" alt=""></li>
            <li><div id="clock" class="breathe"></div></li>
        </ul>
    </div>
    <div id="login">
        <form id='loginf' onsubmit="return checkform()">
            <h1><b>Login:</b></h1>
            <p><b>UserName:</b></p>
            <input placeholder="UserName" type="text" title="0" id="UserName" name="username" required>
            <p><b>PassWord:</b></p>
            <input placeholder="PassWord" type="password" title="0" id="PassWord" required><br>
            <input type="hidden" id="md5-PassWord" name="password_MD5">
            <button type="submit" onclick="Login()">Login</button>
            <button type="submit" onclick="Register()">Register</button>           
        </form>
    </div>
    <div id="66"></div>
    <template id="alert">
        <div class="temp1">
            <div class="bt_bg" id="d1"></div>
            <div class="bt_div" id="d2">
                <div class="bt_txt" id="d3"></div>
                <button class="bt_bt" id="b1" onclick="confirm0()"></button>
                <button class="bt_bt" id="b2" onclick="cancel0()"></button>
            </div>
        </div>
    </template>
</body>
<script src="https://code.jquery.com/jquery-4.0.0.min.js"></script>
<script src="../sc.js"></script>
<script>
    /* part1 */
    const isreg = true;
    const std_usnm = /[0-9a-zA-Z]{4,8}/; 
    const std_pswd = /[0-9]{6-10}/;
    /* 调整可见性 */
    
    const msg = (boxid,txt,isErr = true) =>{
        const box = $(boxid);
        box.textContent = txt;
        box.className = isErr ? 'error' : 'success';
    }
    /* 检验输入格式 */
    const exm = (std,txt) => {
        if(!std.test(txt)){
            alert("Format unmatched! Please Try again");
            location.reload();
        }
    }
    function checkform(){
        usnm = $("#UserName");
        pswd = $("#PassWord");
        exm(std_usnm,usnm.innerText);
        exm(std_pswd,pswd.innerText);
        return true;
    }
    const generateToken = (length = 32) => {
        const array = new Uint8Array(length);
        crypto.getRandomValues(array);
        return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
    }
    const form = $('#loginf');
    

    form.addEventListener('submit',(event) => {
        const data = {
            username: form.get('UserName'),
            Token: generateToken(),
            loginTime: Date.now(),
            expires: Date.now() + 24*60*60*1000
        };
    })

/*
    const channel = new BroadcastChannel('form-channel');
    form.addEventListener('submit',(event) => {
        event.preventDefault();
        console.log('登陆中');
        channel.postMessage({
            type: 'FORM_SUBMIT',
            data: {
                username: form.get('UserName'),
                password_MD5: form.get('md5-PassWord'),
                isreg0: isreg
            },
            timestamp: Date.now()
        });
        window.open('key.html','_blank');
    })
*/
    const confirm0 = () => {

    }
    const cancel0 = () => {

    }
    history.addEventListener('back',(event) => {
        const button1 = $('#alert');
        const btarea = $('66');
        const temp =  button.content.cloneNode(true);
        const root = temp.querySelector("temp1");
        root.querySelector("#d2").textContent = "";
        root.querySelector("#d3").textContent = "你真的要向前返回吗？可能导致数据全部丢失！";
        root.querySelector("#b1").textContent = "是";
        root.querySelector("#b2").textContent = "否";
    })
    const send2url = (data,url) =>{
        history.pushState(data,'',url);
        window.open(url);
    }
    
   
    
</script>
</html>