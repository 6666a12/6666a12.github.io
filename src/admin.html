<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log in</title>
    <link rel="stylesheet" type="text/css" href="../css/m.css">
    <link rel="stylesheet" type="text/css" href="../css/log-in.css">
</head>
<body onload="main()">
    <div class="ed" id="edit">
        <img class="bg" style="opacity: 0.25" alt="" src="../pic/yz.jpg">
    </div>  
    <div id="topm">
        <ul class="topmenu">
            <li><img src="../pic/stream-pig.gif" width="40" height="40" alt=""></li>
            <li><div id="clock"></div></li>
        </ul>
    </div>
    <div id="login">
        <form id='loginf' onsubmit="return checkform()">
            <p><b>UserName:</b></p>
            <input placeholder="UserName" type="text" title="0" id="UserName" name="username" required>
            <p><b>PassWord:</b></p>
            <input placeholder="PassWord" type="password" title="0" id="PassWord" required><br>
            <input type="hidden" id="md5-PassWord" name="password_MD5">
            <button type="submit" onclick="isreg = true">Login</button>
            <button type="submit" onclick="isreg = false">Register</button>           
        </form>
    </div>
    
</body>
<script src="https://code.jquery.com/jquery-4.0.0.min.js"></script>
<script src="../sc.js"></script>
<script>
    /* part1 */
    const isreg = true;
    const std_usnm = /[0-9a-zA-Z]{4,8}/; 
    const std_pswd = /[0-9]{6-10}/;
    /* 调整可见性 */
    const show = (el,yes = true) => el.classList.toggle("hidden",!yes);
    const msg = (boxid,txt,isErr = true) =>{
        const box = $(boxid);
        box.textContent = txt;
        box.className = isErr ? 'error' : 'success';
    }
    /* 检验输入格式 */
    const exm = (std,txt) => {
        if(!std.test(txt)){
            alert("Format unmatched! Please Try again");
            location.reload();
        }
    }

    function checkform(){
        usnm = $("#UserName");
        pswd = $("#PassWord");
        exm(std_usnm,usnm.innerText);
        exm(std_pswd,pswd.innerText);
        return true;
    }

    const form = $('#loginf');
    const channel = new BroadcastChannel('form-channel');
    form.addEventListener('submit',(event) => {
        event.preventDefault();
        console.log('登陆中');
        channel.postMessage({
            type: 'FORM_SUBMIT',
            data: {
                username: form.get('UserName'),
                password_MD5: form.get('md5-PassWord'),
                isreg0: isreg
            },
            timestamp: Date.now()
        });
        window.open('key.html','_blank');
    })


    
    const send2url = (data,url) =>{
        history.pushState(data,'',url);
        window.open(url);
    }

   
    
</script>
</html>